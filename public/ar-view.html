<!DOCTYPE html>
<html>
  <head>
    <title>Realistic AR with Tap-to-Place</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

    <!-- AR.js for Markerless AR -->
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/1.7.2/aframe/build/aframe-ar.js"></script>

    <!-- Gesture Detector -->
    <script src="https://unpkg.com/aframe-gesture-detector/dist/aframe-gesture-detector.min.js"></script>

    <!-- Custom Component: Tap-to-Place -->
    <script>
      AFRAME.registerComponent('tap-place', {
        init: function () {
          const scene = this.el.sceneEl;
          const imageEntity = document.querySelector('#placed-image');

          scene.addEventListener('click', function (e) {
            const touchPoint = e.detail.intersection && e.detail.intersection.point;
            if (touchPoint) {
              imageEntity.setAttribute('position', `${touchPoint.x} ${touchPoint.y} ${touchPoint.z}`);
              imageEntity.setAttribute('visible', 'true');
              imageEntity.setAttribute('animation', {
                property: 'scale',
                to: '0.5 0.5 0.5',
                dur: 500,
                easing: 'easeOutElastic'
              });
            }
          });
        }
      });
    </script>
  </head>

  <body style="margin: 0; overflow: hidden; touch-action: none;">
    <a-scene
      embedded
      tap-place
      arjs="sourceType: webcam; facingMode: environment; debugUIEnabled: false;"
      gesture-detector
      renderer="logarithmicDepthBuffer: true;"
    >

      <!-- Lighting -->
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 1 0.5"></a-entity>

      <!-- Shadow ground (optional) -->
      <a-plane
        rotation="-90 0 0"
        width="20"
        height="20"
        color="#fff"
        shadow
        visible="false"
      ></a-plane>

      <!-- Tap-to-place Image (initially invisible) -->
      <a-entity
        id="placed-image"
        visible="false"
        scale="0.001 0.001 0.001"
        gesture-detector
      >
        <a-image
          src="overlay.png"  <!-- Replace with transparent image -->
          width="1"
          height="1"
          position="0 0 0"
        ></a-image>
      </a-entity>

      <a-entity camera look-controls></a-entity>
    </a-scene>
  </body>
</html>
